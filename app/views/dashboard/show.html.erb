<section class="hero">
  <div>
    <p class="eyebrow">Dashboard</p>
    <h2><%= current_user.admin? ? "Admin Control Center" : "Quote Overview" %></h2>
    <p class="lead">
      <% if current_user.admin? %>
        Manage customer access and monitor incoming quote activity in one place.
      <% else %>
        Track your quote requests and submit new curtain specifications quickly.
      <% end %>
    </p>
  </div>
</section>

<% if current_user.admin? %>
  <% unless @admin_compact %>
    <section class="metric-grid">
      <article class="metric">
        <p class="metric__label">Latest Customers</p>
        <p class="metric__value"><%= @customers.size %></p>
      </article>
      <article class="metric">
        <p class="metric__label">Recent Quotes</p>
        <p class="metric__value"><%= @recent_quotes.size %></p>
      </article>
      <article class="metric">
        <p class="metric__label">Active Products</p>
        <p class="metric__value"><%= @active_products_count %></p>
      </article>
      <article class="metric">
        <p class="metric__label">Open Jobs</p>
        <p class="metric__value"><%= @active_jobs_count %></p>
      </article>
    </section>

    <section class="panel">
      <h3>Recent Quote Requests</h3>
      <div class="table-wrap">
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Quote #</th>
              <th>Customer</th>
              <th>Items</th>
              <th>Total</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @recent_quotes.each do |quote| %>
              <tr>
                <td><%= link_to quote.id, admin_quote_request_path(quote) %></td>
                <td><%= link_to quote.quote_number, admin_quote_request_path(quote) %></td>
                <td><%= quote.user.email %></td>
                <td><%= quote.line_items_count %></td>
                <td><%= number_to_currency(quote.total, unit: "#{quote.currency} ") %></td>
                <td><span class="status-pill status-pill--<%= quote.status %>"><%= quote.status.humanize %></span></td>
                <td class="table-actions">
                  <%= link_to "View", admin_quote_request_path(quote), class: "button button--secondary button--small" %>
                  <%= link_to "PDF", document_admin_quote_request_path(quote, format: :pdf), class: "button button--primary button--small" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </section>
  <% end %>

  <%= render "admin_tabs" %>
<% else %>
  <section class="metric-grid">
    <article class="metric">
      <p class="metric__label">Total Quotes</p>
      <p class="metric__value"><%= @quote_history.size %></p>
    </article>
    <article class="metric">
      <p class="metric__label">Recent Quotes</p>
      <p class="metric__value"><%= @recent_quotes.size %></p>
    </article>
    <article class="metric">
      <p class="metric__label">Last Total</p>
      <p class="metric__value metric__value--small">
        <%= @recent_quotes.first.present? ? number_to_currency(@recent_quotes.first.total, unit: "#{@recent_quotes.first.currency} ") : "N/A" %>
      </p>
    </article>
  </section>

  <%= render "customer_tabs" %>
<% end %>
